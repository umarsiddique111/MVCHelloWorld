{
"variables": {
    "bucketname": "",
	"filename": "",
	"aws_access_key":"",
	"aws_secret_key":"",
	"ami-img":""
    
  },
"builders": [
    {
      "type": "amazon-ebs",
      "access_key": "{{user `aws_access_key`}}",
      "secret_key": "{{user `aws_secret_key`}}",
      "region": "ap-south-1",
      "instance_type": "t2.micro",
      "source_ami":"{{user `ami-img`}}",
      "ami_name": "windows-aws-base-{{timestamp}}",
      "communicator": "winrm",
      "winrm_username": "umar",
      "winrm_port":5985,
      "vpc_id":	"vpc-e595b48d",
      "subnet_id":"subnet-9aca84f2",
      "security_group_id":"sg-0b93c59f7a615c7ed"
    }
  ],
  "description": "AWS Image",
	"provisioners": [
		{
		 "type": "powershell",
 		 "inline": [
 		 "C:\\ProgramData\\Amazon\\EC2-Windows\\Launch\\Scripts\\InitializeInstance.ps1 -Schedule",
 		 "C:\\ProgramData\\Amazon\\EC2-Windows\\Launch\\Scripts\\SysprepInstance.ps1 -NoShutdown"
         ]
         },
		{
			"type": "powershell",
			"inline":[
			"choco install awscli",
			"aws s3 cp s3://{{user `bucketname`}}/{{user `filename`}}.rar {{user `filename`}}.rar",
			"unrar e {{user `filename`}}.rar",
			"rmdir /s {{user `filename`}}.rar",
			"cp {{user `filename`}} *.*  'c:\\inetpub\\wwwroot'"
			 ]
    }
		
  ]
 }
