{
"variables": {
    "bucketname": "",
	"filename": "",
	"aws_access_key":"",
	"aws_secret_key":"",
	"ami-img":""
    
  },
"builders": [
    {
      "type": "amazon-ebs",
      "access_key": "{{user `aws_access_key`}}",
      "secret_key": "{{user `aws_secret_key`}}",
      "region": "ap-south-1",
      "instance_type": "t2.micro",
      "source_ami":"{{user `ami-img`}}",
      "ami_name": "windows-aws-base-{{timestamp}}",
	"user_data_file": "ec2-userdata1.ps1",
      "communicator": "winrm",
      "winrm_username": "Administrator",
       "winrm_password": "VAk(xynmdNyuB=crmpROV?k!msPfM.dd",
      "winrm_use_ssl": false,
      "winrm_insecure": true,
       "winrm_wait_timeout": "5m"
    }
  ],
  "description": "AWS Image",
	"provisioners": [
		{
			"type": "powershell",
			"inline":[
			"choco install awscli",
			"aws s3 cp s3://{{user `bucketname`}}/{{user `filename`}}.rar {{user `filename`}}.rar",
			"unrar e {{user `filename`}}.rar",
			"rmdir /s {{user `filename`}}.rar",
			"cp {{user `filename`}} *.*  'c:\\inetpub\\wwwroot'"
			 ]
    },
		{
      "type": "powershell","inline": [
        "C:\\ProgramData\\Amazon\\EC2-Windows\\Launch\\Scripts\\SendWindowsIsReady.ps1 -Schedule",
        "C:\\ProgramData\\Amazon\\EC2-Windows\\Launch\\Scripts\\InitializeInstance.ps1 -Schedule",
        "C:\\ProgramData\\Amazon\\EC2-Windows\\Launch\\Scripts\\SysprepInstance.ps1 -NoShutdown"
      ]
    }
  ]
 }
